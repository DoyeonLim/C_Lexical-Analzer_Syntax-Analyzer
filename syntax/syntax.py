action_table = {
    (0, 'vtype'): 's4',
    (0, '$'): 'r3',
    (1, '$'): 'acc',
    (2, 'vtype'): 's4',
    (2, '$'): 'r3',
    (3, 'vtype'): 's4',
    (3, '$'): 'r3',
    (4, 'id'): 's7',
    (5, '$'): 'r1',
    (6, '$'): 'r2',
    (7, 'semi'): 's8',
    (7, 'lparen'): 's9',
    (8, 'vtype'): 'r4',
    (8, 'id'): 'r4',
    (8, 'rbrace'): 'r4',
    (8, 'if'): 'r4',
    (8, 'while'): 'r4',
    (8, 'return'): 'r4',
    (8, '$'): 'r4',
    (9, 'vtype'): 's11',
    (9, 'rparen'): 'r7',
    (10, 'rparen'): 's12',
    (11, 'id'): 's13',
    (12, 'lbrace'): 's14',
    (13, 'rparen'): 'r9',
    (13, 'comma'): 's16',
    (14, 'vtype'): 's23',
    (14, 'id'): 's20',
    (14, 'rbrace'): 'r11',
    (14, 'if'): 's21',
    (14, 'while'): 's22',
    (14, 'return'): 'r11',
    (15, 'rparen'): 'r6',
    (16, 'vtype'): 's24',
    (17, 'return'): 's26',
    (18, 'vtype'): 's23',
    (18, 'id'): 's20',
    (18, 'rbrace'): 'r11',
    (18, 'if'): 's21',
    (18, 'while'): 's22',
    (18, 'return'): 'r11',
    (19, 'vtype'): 'r12',
    (19, 'id'): 'r12',
    (19, 'rbrace'): 'r12',
    (19, 'if'): 'r12',
    (19, 'while'): 'r12',
    (19, 'return'): 'r12',
    (20, 'assign'): 's28',
    (21, 'lparen'): 's29',
    (22, 'lparen'): 's30',
    (23, 'id'): 's31',
    (24, 'id'): 's32',
    (25, 'rbrace'): 's33',
    (26, 'id'): 's36',
    (26, 'lparen'): 's35',
    (26, 'num'): 's37',
    (27, 'rbrace'): 'r10',
    (27, 'return'): 'r10',
    (28, 'id'): 's36',
    (28, 'lparen'): 's35',
    (28, 'literal'): 's40',
    (28, 'num'): 's37',
    (29, 'id'): 's36',
    (29, 'lparen'): 's35',
    (29, 'num'): 's37',
    (30, 'id'): 's36',
    (30, 'lparen'): 's35',
    (30, 'num'): 's37',
    (31, 'semi'): 's8',
    (32, 'rparen'): 'r9',
    (32, 'comma'): 's16',
    (33, 'vtype'): 'r5',
    (33, '$'): 'r5',
    (34, 'semi'): 's47',
    (35, 'id'): 's36',
    (35, 'lparen'): 's35',
    (35, 'num'): 's37',
    (36, 'semi'): 'r23',
    (36, 'rparen'): 'r23',
    (36, 'addsub'): 'r23',
    (36, 'multdiv'): 'r23',
    (36, 'comp'): 'r23',
    (37, 'semi'): 'r24',
    (37, 'rparen'): 'r24',
    (37, 'addsub'): 'r24',
    (37, 'multdiv'): 'r24',
    (37, 'comp'): 'r24',
    (38, 'semi'): 's49',
    (39, 'semi'): 'r16',
    (40, 'semi'): 'r17',
    (41, 'semi'): 'r19',
    (41, 'rparen'): 'r19',
    (41, 'addsub'): 's50',
    (42, 'semi'): 'r21',
    (42, 'rparen'): 'r21',
    (42, 'addsub'): 'r21',
    (42, 'multdiv'): 's51',
    (43, 'rparen'): 's52',
    (44, 'comp'): 's53',
    (45, 'rparen'): 's54',
    (46, 'rparen'): 'r8',
    (47, 'rbrace'): 'r26',
    (48, 'rparen'): 's55',
    (49, 'vtype'): 'r13',
    (49, 'id'): 'r13',
    (49, 'rbrace'): 'r13',
    (49, 'if'): 'r13',
    (49, 'while'): 'r13',
    (49, 'return'): 'r13',
    (50, 'id'): 's36',
    (50, 'lparen'): 's35',
    (50, 'num'): 's37',
    (51, 'id'): 's36',
    (51, 'lparen'): 's35',
    (51, 'num'): 's37',
    (52, 'lbrace'): 's58',
    (53, 'id'): 's36',
    (53, 'lparen'): 's35',
    (53, 'num'): 's37',
    (54, 'lbrace'): 's60',
    (55, 'semi'): 'r22',
    (55, 'rparen'): 'r22',
    (55, 'addsub'): 'r22',
    (55, 'multdiv'): 'r22',
    (55, 'comp'): 'r22',
    (56, 'semi'): 'r18',
    (56, 'rparen'): 'r18',
    (57, 'semi'): 'r20',
    (57, 'rparen'): 'r20',
    (57, 'addsub'): 'r20',
    (58, 'vtype'): 's23',
    (58, 'id'): 's20',
    (58, 'rbrace'): 'r11',
    (58, 'if'): 's21',
    (58, 'while'): 's22',
    (58, 'return'): 'r11',
    (59, 'rparen'): 'r25',
    (60, 'vtype'): 's23',
    (60, 'id'): 's20',
    (60, 'rbrace'): 'r11',
    (60, 'if'): 's21',
    (60, 'while'): 's22',
    (60, 'return'): 'r11',
    (61, 'rbrace'): 's63',
    (62, 'rbrace'): 's64',
    (63, 'else'): 's65',
    (64, 'vtype'): 'r15',
    (64, 'id'): 'r15',
    (64, 'rbrace'): 'r15',
    (64, 'if'): 'r15',
    (64, 'while'): 'r15',
    (64, 'return'): 'r15',
    (65, 'lbrace'): 's66',
    (66, 'vtype'): 's23',
    (66, 'id'): 's20',
    (66, 'rbrace'): 'r11',
    (66, 'if'): 's21',
    (66, 'while'): 's22',
    (66, 'return'): 'r11',
    (67, 'rbrace'): 's68',
    (68, 'vtype'): 'r14',
    (68, 'id'): 'r14',
    (68, 'rbrace'): 'r14',
    (68, 'if'): 'r14',
    (68, 'while'): 'r14',
    (68, 'return'): 'r14',
}

reduce_table = {
    # START
    ('before', 0): 1,

    # CODE
    ('before', 1): 2,
    ('before', 2): 2,
    ('before', 3): 0,

    # VDECL
    ('before', 4): 3,

    # FDECL
    ('before', 5): 9,

    # ARG
    ('before', 6): 3,
    ('before', 7): 0,

    # MOREARGS
    ('before', 8): 4,
    ('before', 9): 0,

    # BLOCK
    ('before', 10): 2,
    ('before', 11): 0,

    # STMT
    ('before', 12): 1,
    ('before', 13): 4,
    ('before', 14): 11,
    ('before', 15): 7,

    # RHS
    ('before', 16): 1,
    ('before', 17): 1,

    # EXPR
    ('before', 18): 3,
    ('before', 19): 1,

    # TERM
    ('before', 20): 3,
    ('before', 21): 1,

    # FACTOR
    ('before', 22): 3,
    ('before', 23): 1,
    ('before', 24): 1,

    # COND
    ('before', 25): 3,

    # RETURN
    ('before', 26): 3,

    ('after', 0): 'START',
    ('after', 1): 'CODE',
    ('after', 2): 'CODE',
    ('after', 3): 'CODE',
    ('after', 4): 'VDECL',
    ('after', 5): 'FDECL',
    ('after', 6): 'ARG',
    ('after', 7): 'ARG',
    ('after', 8): 'MOREARGS',
    ('after', 9): 'MOREARGS',
    ('after', 10): 'BLOCK',
    ('after', 11): 'BLOCK',
    ('after', 12): 'STMT',
    ('after', 13): 'STMT',
    ('after', 14): 'STMT',
    ('after', 15): 'STMT',
    ('after', 16): 'RHS',
    ('after', 17): 'RHS',
    ('after', 18): 'EXPR',
    ('after', 19): 'EXPR',
    ('after', 20): 'TERM',
    ('after', 21): 'TERM',
    ('after', 22): 'FACTOR',
    ('after', 23): 'FACTOR',
    ('after', 24): 'FACTOR',
    ('after', 25): 'COND',
    ('after', 26): 'RETURN'
}

goto_table = {
    (0, 'CODE'): 1,
    (0, 'VDECL'): 2,
    (0, 'FDECL'): 3,
    (2, 'CODE'): 5,
    (2, 'VDECL'): 2,
    (2, 'FDECL'): 3,
    (3, 'CODE'): 6,
    (3, 'VDECL'): 2,
    (3, 'FDECL'): 3,
    (9, 'ARG'): 10,
    (13, 'MOREARGS'): 15,
    (14, 'VDECL'): 19,
    (14, 'BLOCK'): 17,
    (14, 'STMT'): 18,
    (17, 'RETURN'): 25,
    (18, 'VDECL'): 19,
    (18, 'BLOCK'): 27,
    (18, 'STMT'): 18,
    (26, 'FACTOR'): 34,
    (28, 'RHS'): 38,
    (28, 'EXPR'): 39,
    (28, 'TERM'): 41,
    (28, 'FACTOR'): 42,
    (29, 'FACTOR'): 44,
    (29, 'COND'): 43,
    (30, 'FACTOR'): 44,
    (30, 'COND'): 45,
    (32, 'MOREARGS'): 46,
    (35, 'EXPR'): 48,
    (35, 'TERM'): 41,
    (35, 'FACTOR'): 42,
    (50, 'EXPR'): 56,
    (50, 'TERM'): 41,
    (50, 'FACTOR'): 42,
    (51, 'TERM'): 57,
    (51, 'FACTOR'): 42,
    (53, 'FACTOR'): 59,
    (58, 'VDECL'): 19,
    (58, 'BLOCK'): 61,
    (58, 'STMT'): 18,
    (60, 'VDECL'): 19,
    (60, 'BLOCK'): 62,
    (60, 'STMT'): 18,
    (66, 'VDECL'): 19,
    (66, 'BLOCK'): 67,
    (66, 'STMT'): 18
}

exec(open("lexical.py").read())

doneFlag = False

with open("test.out", "rt") as fin:
    lines = fin.readlines()
    lines.append('$')
    stack = [0]
    index = 0
    token = lines[index].rstrip('\n').split(',')
    index += 1

    try:
        while True:
            state = stack[-1]
            action = action_table.get((state, token[0]))
            if action == 'acc':
                print("accept")
                break
            elif action[0] == 's':
                next_state = int(action[1:])
                stack.append(next_state)
                if not doneFlag:
                    token = lines[index].rstrip('\n').split(',')
                    if token == '$':
                        doneFlag = True
                    index += 1

            elif action[0] == 'r':
                next_state = int(action[1:])
                tmp = reduce_table.get(('after', next_state))
                for _ in range(int(reduce_table.get(('before', next_state)))):
                    stack.pop()
                state = stack[-1]
                next_state = goto_table.get((state, tmp))
                stack.append(next_state)
    except:
        print("reject : %dth token(%s) is invalid" % (index, token[0]))

